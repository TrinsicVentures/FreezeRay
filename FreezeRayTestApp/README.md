# FreezeRayTestApp

**Purpose:** Demonstration iOS app showing FreezeRay integration and E2E validation test bed.

---

## What This App Demonstrates

This is a real Xcode iOS project that shows:
1. How to integrate FreezeRay into your iOS app
2. The incremental workflow of freezing schema versions
3. How scaffolded tests work in a real project

---

## Current State

### Frozen Versions âœ…

**Version 1.0.0** (frozen)
- Schema: `AppSchemaV1`
- Models: `User` (name, createdAt)
- Fixtures: `FreezeRay/Fixtures/1.0.0/`
- Tests: `FreezeRay/Tests/AppSchemaV1_DriftTests.swift`

**Version 2.0.0** (frozen)
- Schema: `AppSchemaV2`
- Models: `User` (name, createdAt) - lightweight migration
- Fixtures: `FreezeRay/Fixtures/2.0.0/`
- Tests:
  - `FreezeRay/Tests/AppSchemaV2_DriftTests.swift`
  - `FreezeRay/Tests/MigrateV1_0_0toV2_0_0_Tests.swift`

### Ready to Freeze ðŸŽ¯

**Version 3.0.0** (defined but not frozen)
- Schema: `AppSchemaV3` with `@FreezeSchema(version: "3.0.0")`
- Models: `User` + `Post` (adds relationships)
- Status: **Ready for you to freeze!**

---

## Demo: Freezing Version 3.0.0

This demonstrates the complete FreezeRay workflow:

### Step 1: Freeze the Schema

```bash
cd FreezeRayTestApp
../.build/debug/freezeray freeze 3.0.0
```

**Expected output:**
```
âœ… Schema v3.0.0 frozen successfully!

   Fixtures created:
   - FreezeRay/Fixtures/3.0.0/App-3_0_0.sqlite
   - FreezeRay/Fixtures/3.0.0/schema-3_0_0.json
   - FreezeRay/Fixtures/3.0.0/schema-3_0_0.sql
   - FreezeRay/Fixtures/3.0.0/schema-3_0_0.sha256

   Tests scaffolded:
   - FreezeRay/Tests/AppSchemaV3_DriftTests.swift
   - FreezeRay/Tests/MigrateV2_0_0toV3_0_0_Tests.swift
```

### Step 2: Review Generated Files

**Drift Test:** `FreezeRay/Tests/AppSchemaV3_DriftTests.swift`
```swift
@Test("AppSchemaV3 v3.0.0 has not drifted")
func testAppSchemaV3_3_0_0_Drift() throws {
    try AppSchemaV3.__freezeray_check_3_0_0()
    // TODO: Add custom data validation here
}
```

**Migration Test:** `FreezeRay/Tests/MigrateV2_0_0toV3_0_0_Tests.swift`
```swift
@Test("Migrate v2.0.0 â†’ v3.0.0")
func testMigrateV2_0_0toV3_0_0() throws {
    try FreezeRayRuntime.testMigration(
        from: AppSchemaV2.self,
        to: AppSchemaV3.self,
        migrationPlan: AppMigrations.self
    )
    // TODO: Add data integrity checks here
}
```

### Step 3: Customize Tests (Optional)

Add custom validation in the TODO sections:
```swift
// Example: Verify relationship was added
let container = try ModelContainer(...)
let context = container.mainContext
let users = try context.fetch(FetchDescriptor<DataV3.User>())
XCTAssertTrue(users.first?.posts != nil, "User should have posts relationship")
```

### Step 4: Run Tests in Xcode

Press `âŒ˜U` in Xcode to run all tests, including your new drift and migration tests.

### Step 5: Commit to Git

```bash
git add FreezeRay/
git commit -m "Freeze schema v3.0.0 with User+Post relationships"
```

---

## Project Structure

```
FreezeRayTestApp/
â”œâ”€â”€ FreezeRayTestApp/
â”‚   â”œâ”€â”€ Models.swift              # DataV1, DataV2, DataV3 models
â”‚   â”œâ”€â”€ Schemas.swift             # AppSchemaV1/V2/V3 + AppMigrations
â”‚   â””â”€â”€ ContentView.swift         # Simple SwiftUI app
â”œâ”€â”€ FreezeRayTestAppTests/
â”‚   â””â”€â”€ ManualTests.swift         # Basic validation tests
â”œâ”€â”€ FreezeRay/                    # Generated by CLI
â”‚   â”œâ”€â”€ Fixtures/
â”‚   â”‚   â”œâ”€â”€ 1.0.0/                # Frozen v1 artifacts
â”‚   â”‚   â””â”€â”€ 2.0.0/                # Frozen v2 artifacts
â”‚   â””â”€â”€ Tests/
â”‚       â”œâ”€â”€ AppSchemaV1_DriftTests.swift
â”‚       â”œâ”€â”€ AppSchemaV2_DriftTests.swift
â”‚       â””â”€â”€ MigrateV1_0_0toV2_0_0_Tests.swift
â””â”€â”€ FreezeRayTestApp.xcodeproj
```

---

## Schema Evolution

| Version | Change | Migration |
|---------|--------|-----------|
| **1.0.0** | Initial schema: User (name, createdAt) | - |
| **2.0.0** | No model changes (schema version bump only) | Lightweight |
| **3.0.0** | Add Post model + User.posts relationship | Lightweight |

---

## Running Tests

### All Tests
```bash
xcodebuild test \
  -project FreezeRayTestApp.xcodeproj \
  -scheme FreezeRayTestApp \
  -destination 'platform=iOS Simulator,name=iPhone 17'
```

### In Xcode
Press `âŒ˜U` to run all tests

---

## Key Concepts Demonstrated

1. **Incremental Freezing:** Schemas are frozen one version at a time as they're deployed
2. **User-Owned Tests:** Scaffolded tests can be customized with domain-specific validation
3. **Git Integration:** Fixtures are committed for traceability and migration testing
4. **Convention Over Configuration:** CLI auto-detects project structure, no config needed

---

## Notes

- **Why commit fixtures?** Provides full history, enables code review, critical for migration testing
- **Why two frozen versions?** Demonstrates migration testing from v1â†’v2
- **Why is v3 not frozen?** Shows realistic "next step" state for demo purposes
- **Simulator:** Always use "iPhone 17" for consistency

---

For more information, see:
- [Main Documentation](../CLAUDE.md)
- [Architecture Decision Records](../project/adr/)
- [Sprint Documentation](../project/sprints/)
